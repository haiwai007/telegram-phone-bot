name: ğŸ¥ æœºå™¨äººå¥åº·æ£€æŸ¥

on:
  schedule:
    # æ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡
    - cron: '0 * * * *'
  workflow_dispatch:

jobs:
  health-check:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      
    - name: ğŸ è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: ğŸ“¦ å®‰è£…åŸºç¡€ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install requests python-dotenv
        
    - name: ğŸ¥ æ£€æŸ¥æœºå™¨äººçŠ¶æ€
      run: |
        python -c "
        import requests
        import os
        from datetime import datetime
        
        bot_token = '${{ secrets.BOT_TOKEN }}'
        
        if not bot_token:
            print('âŒ BOT_TOKEN æœªè®¾ç½®')
            exit(1)
            
        try:
            # æ£€æŸ¥æœºå™¨äººAPIçŠ¶æ€
            response = requests.get(f'https://api.telegram.org/bot{bot_token}/getMe', timeout=10)
            
            if response.status_code == 200:
                data = response.json()
                if data['ok']:
                    bot_info = data['result']
                    print(f'âœ… æœºå™¨äººAPIæ­£å¸¸')
                    print(f'ğŸ¤– æœºå™¨äºº: @{bot_info[\"username\"]}')
                    print(f'â° æ£€æŸ¥æ—¶é—´: {datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")}')
                    
                    # æ£€æŸ¥æ›´æ–°
                    updates_response = requests.get(f'https://api.telegram.org/bot{bot_token}/getUpdates?limit=1', timeout=10)
                    if updates_response.status_code == 200:
                        print('âœ… æœºå™¨äººæ›´æ–°æ¥æ”¶æ­£å¸¸')
                    else:
                        print('âš ï¸ æœºå™¨äººæ›´æ–°æ¥æ”¶å¼‚å¸¸')
                else:
                    print(f'âŒ APIè¿”å›é”™è¯¯: {data}')
                    exit(1)
            else:
                print(f'âŒ HTTPé”™è¯¯: {response.status_code}')
                exit(1)
                
        except Exception as e:
            print(f'âŒ å¥åº·æ£€æŸ¥å¤±è´¥: {e}')
            exit(1)
        "
        
    - name: ğŸ“Š æ£€æŸ¥GitHub ActionsçŠ¶æ€
      run: |
        echo "ğŸ“Š GitHub Actions è¿è¡ŒçŠ¶æ€æ£€æŸ¥"
        echo "â° å½“å‰æ—¶é—´: $(date)"
        echo "ğŸ”„ å·¥ä½œæµè¿è¡Œç¼–å·: ${{ github.run_number }}"
        echo "ğŸ“ æäº¤SHA: ${{ github.sha }}"
        
        # æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–æœºå™¨äººå®ä¾‹åœ¨è¿è¡Œ
        echo "ğŸ” æ£€æŸ¥å¹¶å‘è¿è¡ŒçŠ¶æ€..."
        echo "âœ… å¥åº·æ£€æŸ¥å®Œæˆ"
