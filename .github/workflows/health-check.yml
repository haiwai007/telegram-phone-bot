name: ğŸ¥ æœºå™¨äººå¥åº·æ£€æŸ¥

on:
  schedule:
    # æ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡æœºå™¨äººçŠ¶æ€
    - cron: '0 * * * *'
  workflow_dispatch:

jobs:
  health-check:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      
    - name: ğŸ è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: ğŸ“¦ å®‰è£…ä¾èµ–
      run: |
        pip install requests
        
    - name: ğŸ” æ£€æŸ¥æœºå™¨äººçŠ¶æ€
      run: |
        python -c "
        import requests
        import sys
        
        bot_token = '${{ secrets.BOT_TOKEN }}'
        if not bot_token:
            print('âŒ BOT_TOKEN æœªè®¾ç½®')
            sys.exit(1)
            
        try:
            response = requests.get(f'https://api.telegram.org/bot{bot_token}/getMe', timeout=10)
            if response.status_code == 200:
                data = response.json()
                if data['ok']:
                    bot_info = data['result']
                    print(f'âœ… æœºå™¨äººçŠ¶æ€æ­£å¸¸')
                    print(f'ğŸ¤– æœºå™¨äººåç§°: {bot_info[\"first_name\"]}')
                    print(f'ğŸ‘¤ ç”¨æˆ·å: @{bot_info[\"username\"]}')
                    print(f'ğŸ†” ID: {bot_info[\"id\"]}')
                else:
                    print(f'âŒ APIè¿”å›é”™è¯¯: {data}')
                    sys.exit(1)
            else:
                print(f'âŒ HTTPé”™è¯¯: {response.status_code}')
                sys.exit(1)
        except Exception as e:
            print(f'âŒ è¿æ¥å¤±è´¥: {e}')
            sys.exit(1)
        "
        
    - name: ğŸ“Š æ£€æŸ¥å·¥ä½œæµçŠ¶æ€
      run: |
        echo "ğŸ” æ£€æŸ¥å½“å‰è¿è¡Œçš„å·¥ä½œæµ..."
        echo "ğŸ“… æ£€æŸ¥æ—¶é—´: $(date)"
        echo "âœ… å¥åº·æ£€æŸ¥å®Œæˆ"
        
    - name: ğŸš¨ å‘é€çŠ¶æ€é€šçŸ¥
      if: failure()
      run: |
        echo "âš ï¸ æœºå™¨äººå¥åº·æ£€æŸ¥å¤±è´¥ï¼"
        echo "ğŸ”§ å»ºè®®æ£€æŸ¥ï¼š"
        echo "  1. BOT_TOKEN æ˜¯å¦æ­£ç¡®"
        echo "  2. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸"
        echo "  3. Telegram API æ˜¯å¦å¯ç”¨"
