name: ğŸ§ª ç®€å•æµ‹è¯•

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      
    - name: ğŸ è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: ğŸ“¦ å®‰è£…åŸºç¡€ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install requests python-telegram-bot python-dotenv pytz
        
    - name: ğŸ”§ åˆ›å»ºç®€å•é…ç½®
      run: |
        mkdir -p é…ç½®æ–‡ä»¶
        echo "BOT_TOKEN=${{ secrets.BOT_TOKEN }}" > é…ç½®æ–‡ä»¶/ç¯å¢ƒé…ç½®.env
        echo "LOG_LEVEL=INFO" >> é…ç½®æ–‡ä»¶/ç¯å¢ƒé…ç½®.env
        echo "TIMEZONE=Asia/Shanghai" >> é…ç½®æ–‡ä»¶/ç¯å¢ƒé…ç½®.env
        
    - name: ğŸ¤– æµ‹è¯•æœºå™¨äººè¿æ¥
      run: |
        python -c "
        import requests
        import os
        from dotenv import load_dotenv
        
        load_dotenv('é…ç½®æ–‡ä»¶/ç¯å¢ƒé…ç½®.env')
        bot_token = os.getenv('BOT_TOKEN')
        
        if not bot_token:
            print('âŒ BOT_TOKEN æœªè®¾ç½®')
            exit(1)
            
        try:
            response = requests.get(f'https://api.telegram.org/bot{bot_token}/getMe', timeout=10)
            if response.status_code == 200:
                data = response.json()
                if data['ok']:
                    bot_info = data['result']
                    print(f'âœ… æœºå™¨äººè¿æ¥æˆåŠŸ')
                    print(f'ğŸ¤– æœºå™¨äººåç§°: {bot_info[\"first_name\"]}')
                    print(f'ğŸ‘¤ ç”¨æˆ·å: @{bot_info[\"username\"]}')
                    print(f'ğŸ†” ID: {bot_info[\"id\"]}')
                else:
                    print(f'âŒ APIè¿”å›é”™è¯¯: {data}')
                    exit(1)
            else:
                print(f'âŒ HTTPé”™è¯¯: {response.status_code}')
                exit(1)
        except Exception as e:
            print(f'âŒ è¿æ¥å¤±è´¥: {e}')
            exit(1)
        "
        
    - name: ğŸ“‹ æµ‹è¯•é¡¹ç›®ç»“æ„
      run: |
        echo "ğŸ“ é¡¹ç›®ç»“æ„æ£€æŸ¥:"
        ls -la
        echo ""
        echo "ğŸ“ æ ¸å¿ƒæ¨¡å—:"
        ls -la æ ¸å¿ƒæ¨¡å—/ || echo "âŒ æ ¸å¿ƒæ¨¡å—ç›®å½•ä¸å­˜åœ¨"
        echo ""
        echo "ğŸ“ é…ç½®æ–‡ä»¶:"
        ls -la é…ç½®æ–‡ä»¶/ || echo "âŒ é…ç½®æ–‡ä»¶ç›®å½•ä¸å­˜åœ¨"
        
    - name: âœ… æµ‹è¯•å®Œæˆ
      run: |
        echo "ğŸ‰ ç®€å•æµ‹è¯•å®Œæˆï¼"
        echo "âœ… æœºå™¨äºº Token æœ‰æ•ˆ"
        echo "âœ… Python ç¯å¢ƒæ­£å¸¸"
        echo "âœ… åŸºç¡€ä¾èµ–å®‰è£…æˆåŠŸ"
